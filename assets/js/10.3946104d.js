(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{166:function(t,n,e){"use strict";e.r(n);var s=e(0),a=Object(s.a)({},function(){var t=this,n=t.$createElement,e=t._self._c||n;return e("div",{staticClass:"content"},[t._m(0),t._v(" "),e("blockquote"),t._v(" "),e("p",[t._v("日常开发中经常会遇到 this 指向的 bug，郁闷好久才猛然醒悟，痛定思痛，将 this 做个汇总，以便在日后的开发工作中少走弯路。")]),t._v(" "),e("p",[t._v("注意：本文讲述只针对浏览器环境。")]),t._v(" "),t._m(1),t._v(" "),t._m(2),e("p",[t._v("可以看出在全局作用域中 this 指向当前的全局对象 Window。")]),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._m(6),t._v(" "),t._m(7),t._m(8),t._v(" "),e("p",[t._v("当一个函数被当作一个对象的方法调用的时候，this 指向当前的对象 obj：")]),t._v(" "),t._m(9),e("hr"),t._v(" "),e("p",[t._v("如果把对象的方法赋值给一个变量，调用该方法时，this 指向 Window：")]),t._v(" "),t._m(10),t._m(11),t._v(" "),e("p",[t._v("在 JS 中，为了实现类，我们需要定义一些构造函数，在调用一个构造函数的时候加上 new 这个关键字：")]),t._v(" "),t._m(12),e("p",[t._v("此时，this 指向这个构造函数调用的时候实例化出来的对象。")]),t._v(" "),e("p",[t._v("当然了，构造函数其实也是一个函数，若将构造函数当做普通函数来调用，this 指向 Window:")]),t._v(" "),t._m(13),t._m(14),t._v(" "),t._m(15),t._m(16),e("p",[t._v("如果没有特殊指向（指向更改请看下方：怎么改变 this 的指向），setInterval 和setTimeout 的回调函数中 this 的指向都是 Window 。这是因为 JS 的定时器方法是定义在 Window 下的。")]),t._v(" "),t._m(17),t._v(" "),e("p",[t._v("在全局环境中调用：")]),t._v(" "),t._m(18),e("hr"),t._v(" "),e("p",[t._v("作为对象的一个函数调用：")]),t._v(" "),t._m(19),t._m(20),e("p",[t._v("不难发现，普通函数作为对象的一个函数被调用，this 指向 obj，箭头函数作为对象的一个函数被调用，this 指向 Window。")]),t._v(" "),e("hr"),t._v(" "),e("p",[t._v("特殊情况：结合定时器调用：")]),t._v(" "),t._m(21),t._m(22),e("p",[t._v("若在对象的函数中，普通函数作为定时器延时执行的函数调用，this 指向 Window；箭头函数作为定时器延时执行的函数调用， this 指向定义时所在的对象，也就是 func 中的 this，即 obj。")]),t._v(" "),t._m(23),t._v(" "),t._m(24),t._v(" "),e("p",[t._v("call:")]),t._v(" "),t._m(25),e("p",[t._v("它会立即执行函数，第一个参数是指定执行函数中 this 的上下文，后面的参数是执行函数需要传入的参数；")]),t._v(" "),e("hr"),t._v(" "),e("p",[t._v("apply：")]),t._v(" "),t._m(26),e("p",[t._v("它也会立即执行函数，第一个参数是指定执行函数中 this 的上下文，第二个参数是一个数组，是传给执行函数的参数（与 call 的区别）；")]),t._v(" "),e("hr"),t._v(" "),e("p",[t._v("bind：")]),t._v(" "),t._m(27),e("p",[t._v("它不会执行函数，而是返回一个新的函数，这个新的函数被指定了 this 的上下文，后面的参数是执行函数需要传入的参数；")]),t._v(" "),e("p",[t._v("我们来看个示例：")]),t._v(" "),t._m(28),e("p",[t._v("在这个示例中，call、apply 和 bind 的 this 都指向了 obj，都能正常运行；call、apply 会立即执行函数，call 和 apply 的区别就在于传递的参数，call 接收多个参数列表，apply 接收一个包含多个参数的数组；bind 不是立即执行函数，它返回一个函数，需要执行 p2 才能返回结果，bind 接收多个参数列表。")]),t._v(" "),t._m(29),t._v(" "),e("p",[t._v("为什么讲这个模块呢，为了便于大家更加透彻的理解上面所讲述的 this 指向问题，以及更加彻底的理解 JS 函数中重要的三种方法：call、apply、bind 的使用；并且在实际的项目开发中，我们经常会遇到需要改变 this 指向的情况。")]),t._v(" "),e("p",[t._v("我们来看下都有哪些方法：")]),t._v(" "),t._m(30),t._v(" "),t._m(31),e("p",[t._v("这时会报错，因为 setTimeout 里函数的 this 指向 Window，而 Window 对象上是没有 func1 这个函数的。下面我们来修改成箭头函数：")]),t._v(" "),t._m(32),e("p",[t._v("这时候，没有报错，因为箭头函数的 this 的值取决于该函数外部非箭头函数的 this 的值，也就是 func2 的 this 的值， 即 obj。")]),t._v(" "),t._m(33),t._v(" "),t._m(34),e("p",[t._v("此时，func2 也能正常运行。在 func2 中，首先设置 var _this = this，这里的 this 是指向 func2 的对象 obj，为了防止在 func2 中的 setTimeout 被 window 调用而导致的在 setTimeout 中的 this 为 window。我们将 this (指向变量 obj) 赋值给一个变量 _this，这样，在 func2 中我们使用 _this 就是指向对象 obj 了。")]),t._v(" "),t._m(35),t._v(" "),e("p",[t._v("call：")]),t._v(" "),t._m(36),e("hr"),t._v(" "),e("p",[t._v("apply:")]),t._v(" "),t._m(37),e("hr"),t._v(" "),e("p",[t._v("bind:")]),t._v(" "),t._m(38),e("p",[t._v("call、apply、bind 都能改变 this 的上下文对象，所以也没有报错，可以正常执行。")]),t._v(" "),e("p",[t._v("具体原因可看上述第七点，call、apply、bind。")]),t._v(" "),t._m(39),t._v(" "),e("p",[t._v("如上：第四点，作为一个构造函数使用。")]),t._v(" "),e("p",[t._v("参考文章：\n"),e("a",{attrs:{href:"https://segmentfault.com/a/1190000017075730",target:"_blank",rel:"noopener noreferrer"}},[t._v("秒懂this"),e("OutboundLink")],1)])])},[function(){var t=this.$createElement,n=this._self._c||t;return n("h1",{attrs:{id:"this-总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#this-总结","aria-hidden":"true"}},[this._v("#")]),this._v(" this 总结")])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"一：全局执行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#一：全局执行","aria-hidden":"true"}},[this._v("#")]),this._v(" 一：全局执行")])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v("console.log(this);\n// Window\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"二：函数中执行"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#二：函数中执行","aria-hidden":"true"}},[this._v("#")]),this._v(" 二：函数中执行")])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"_1-非严格模式中"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-非严格模式中","aria-hidden":"true"}},[this._v("#")]),this._v(" 1. 非严格模式中")])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v("function func () {\n  console.log(this);\n}\nfunc();\n// Window\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"_2-严格模式中"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-严格模式中","aria-hidden":"true"}},[this._v("#")]),this._v(" 2. 严格模式中")])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v('"use strict";\nfunction func () {\n  console.log(this);\n}\nfunc();\n// undefined\n')])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"三：作为对象的方法调用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三：作为对象的方法调用","aria-hidden":"true"}},[this._v("#")]),this._v(" 三：作为对象的方法调用")])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v("var obj = {\n  name: 'kk',\n  func: function () {\n    console.log(this.name);\n  }\n}\nobj.func();\n// kk\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v("var obj = {\n  name: 'kk',\n  func: function () {\n    console.log(this);\n  }\n}\nvar test = obj.func;\ntest();\n// Window\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"四：作为一个构造函数使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#四：作为一个构造函数使用","aria-hidden":"true"}},[this._v("#")]),this._v(" 四：作为一个构造函数使用")])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v("function Person (name) {\n  this.name = name;\n  console.log(this);\n}\nvar p1 = new Person('kk');\n// Person\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v("function Person (name) {\n  this.name = name;\n  console.log(this);\n}\nvar p2 = Person('MM');\n// Window\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"五：在定时器中使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#五：在定时器中使用","aria-hidden":"true"}},[this._v("#")]),this._v(" 五：在定时器中使用")])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v("setInterval(function () {\n  console.log(this);\n}, 2000)\n// Window\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v("setTimeout(function () {\n  console.log(this);\n}, 0)\n// Window\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"六：箭头函数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#六：箭头函数","aria-hidden":"true"}},[this._v("#")]),this._v(" 六：箭头函数")])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v("var func = () => {\n  console.log(this);\n}\nfunc();\n// Window\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v("var obj = {\n    name: 'hh',\n    func: function () {\n       console.log(this);\n    }\n}\nobj.func();\n// obj\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v("var obj = {\n    name: 'hh',\n    func: () => {\n       console.log(this);\n    }\n}\nobj.func();\n// Window\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v("var obj = {\n    name: 'hh',\n    func: function () {\n        setTimeout(function () {\n            console.log(this);\n        }, 0)\n    }\n}\nobj.func();\n// Window\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v("var obj = {\n  name: 'hh',\n  func: function () {\n    setTimeout(() => {\n      console.log(this);\n    }, 0)\n  }\n}\nobj.func();\n// obj\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("blockquote",[n("p",[this._v("箭头函数中 this 的值取决于该函数外部非箭头函数的 this 的值，且不能通过 call() 、 apply() 和 bind() 方法来改变 this 的值。")])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"七：call、apply、bind"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#七：call、apply、bind","aria-hidden":"true"}},[this._v("#")]),this._v(" 七：call、apply、bind")])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v("fun.call(thisArg[, arg1[, arg2[, ...]]])\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v("fun.apply(thisArg, [argsArray])\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v("var foo = fun.bind(thisArg[, arg1[, arg2[, ...]]]);\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v("function Person(name, age) {\n  this.name = name;\n  this.age = age;\n  console.log(this);\n}\nvar obj = {\n  name: 'kk',\n  age: 6\n};\nPerson.call(obj, 'mm', 10);\n// obj，{name: \"mm\", age: 10}\n\nPerson.apply(obj, ['mm', 10]);\n// obj，{name: \"mm\", age: 10}\n\nvar p1 = Person.bind(obj, 'mm', 10)\nvar p2 = new p1();\n// Person {name: \"mm\", age: 10}\n")])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h2",{attrs:{id:"应用：怎么改变-this-的指向"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#应用：怎么改变-this-的指向","aria-hidden":"true"}},[this._v("#")]),this._v(" 应用：怎么改变 this 的指向")])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"_1-使用-es6-的箭头函数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-使用-es6-的箭头函数","aria-hidden":"true"}},[this._v("#")]),this._v(" 1. 使用 es6 的箭头函数")])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v('var name = "hh";\nvar obj = {\n    name : "kk",\n    func1: function () {\n        console.log(this.name)     \n    },\n    func2: function () {\n        setTimeout(function () {\n            this.func1()\n        }, 1000);\n    }\n};\n\nobj.func2();\n// Uncaught TypeError: this.func1 is not a function\n')])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v('var name = "hh";\nvar obj = {\n    name : "kk",\n    func1: function () {\n        console.log(this.name)     \n    },\n    func2: function () {\n        setTimeout(() => {\n            this.func1()\n        }, 1000);\n    }\n};\n\nobj.func2();\n// kk\n')])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"_2-在函数内部使用-this-this"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-在函数内部使用-this-this","aria-hidden":"true"}},[this._v("#")]),this._v(" 2. 在函数内部使用 _this = this")])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v('var name = "hh";\nvar obj = {\n    name : "kk",\n    func1: function () {\n        console.log(this.name)     \n    },\n    func2: function () {\n      let _this = this;\n        setTimeout(function () {\n            _this.func1()\n        }, 1000);\n    }\n};\n\nobj.func2();\n// kk\n')])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"_3-使用-call、apply、bind"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-使用-call、apply、bind","aria-hidden":"true"}},[this._v("#")]),this._v(" 3. 使用 call、apply、bind")])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v('var name = "hh";\nvar obj = {\n    name : "kk",\n    func1: function () {\n        console.log(this.name)     \n    },\n    func2: function () {\n        setTimeout(function () {\n            this.func1()\n        }.call(obj), 1000);\n    }\n};\n\nobj.func2();\n// kk\n\n')])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v('var name = "hh";\nvar obj = {\n    name : "kk",\n    func1: function () {\n        console.log(this.name)     \n    },\n    func2: function () {\n        setTimeout(function () {\n            this.func1()\n        }.apply(obj), 1000);\n    }\n};\n\nobj.func2();\n// kk\n')])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[this._v('var name = "hh";\nvar obj = {\n    name : "kk",\n    func1: function () {\n        console.log(this.name)     \n    },\n    func2: function () {\n        setTimeout(function () {\n            this.func1()\n        }.bind(obj)(), 1000);\n    }\n};\n\nobj.func2();\n// kk\n')])])])},function(){var t=this.$createElement,n=this._self._c||t;return n("h3",{attrs:{id:"_4-new-实例化一个对象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-new-实例化一个对象","aria-hidden":"true"}},[this._v("#")]),this._v(" 4. new 实例化一个对象")])}],!1,null,null,null);a.options.__file="this.md";n.default=a.exports}}]);